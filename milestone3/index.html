<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book Explorer</title>
  <style>
    /* Add some minimal styling */
    body { font-family: Arial, sans-serif; margin: 20px; }
    #results div.book { margin-bottom: 10px; cursor: pointer; }
    #pagination button { margin: 0 3px; }
    #bookDetails { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
  </style>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body>
  <header>
    <h1>Book Explorer</h1>
  </header>

  <main>
    <!-- Search Section -->
    <section id="search-section">
      <input type="text" id="searchTerm" placeholder="Search for books..." />
      <button id="searchBtn">Search</button>
    </section>

    <!-- Search Results + Pagination -->
    <section id="search-results-section">
      <h2>Search Results</h2>
      <div id="results"></div>
      <div id="pagination"></div>
    </section>

    <!-- Book Details -->
    <section id="book-details-section">
      <h2>Book Details</h2>
      <div id="bookDetails"></div>
    </section>

    <!-- Bookshelf -->
    <section id="bookshelf-section">
      <h2>My Bookshelf</h2>
      <div id="bookshelf"></div>
    </section>
  </main>

  <script>
    const maxResultsPerPage = 10;
    let currentResults = [];
    let currentSearchTerm = "";
    let currentPage = 1;

    function renderPagination(totalResults) {
      const totalPages = Math.min(5, Math.ceil(totalResults / maxResultsPerPage));
      const paginationDiv = $("#pagination");
      paginationDiv.empty();
      for (let i = 1; i <= totalPages; i++) {
        const btn = $('<button>').text(i);
        if (i === currentPage) btn.attr("disabled", true);
        btn.on("click", function () {
          currentPage = i;
          performSearch(currentSearchTerm);
        });
        paginationDiv.append(btn);
      }
    }

    function renderResults() {
      const resultsDiv = $("#results");
      resultsDiv.empty();

      const startIndex = (currentPage - 1) * maxResultsPerPage;
      const endIndex = startIndex + maxResultsPerPage;
      const pageResults = currentResults.slice(startIndex, endIndex);

      if (pageResults.length === 0) {
        resultsDiv.text("No results found.");
        return;
      }

      pageResults.forEach(book => {
        const title = book.volumeInfo.title || "No Title";
        const thumbnail = book.volumeInfo.imageLinks?.thumbnail || "";
        const bookDiv = $('<div class="book">');
        bookDiv.append(`<img src="${thumbnail}" alt="${title}" style="height:100px; vertical-align: middle; margin-right: 10px;">`);
        bookDiv.append(`<span>${title}</span>`);
        bookDiv.css("cursor", "pointer");
        bookDiv.on("click", () => showBookDetails(book.id));
        resultsDiv.append(bookDiv);
      });
    }

    function showBookDetails(bookId) {
      $("#bookDetails").text("Loading details...");
      $.ajax({
        url: `https://www.googleapis.com/books/v1/volumes/${bookId}`,
        method: "GET",
        success: function (data) {
          const info = data.volumeInfo;
          const html = `
            <h3>${info.title || "No Title"}</h3>
            <p><strong>Authors:</strong> ${info.authors ? info.authors.join(", ") : "N/A"}</p>
            <p><strong>Publisher:</strong> ${info.publisher || "N/A"}</p>
            <p><strong>Description:</strong> ${info.description || "No description available."}</p>
            <img src="${info.imageLinks?.thumbnail || ''}" alt="${info.title}" style="max-width: 200px;"/>
          `;
          $("#bookDetails").html(html);
        },
        error: function () {
          $("#bookDetails").text("Failed to load book details.");
        }
      });
    }

    function performSearch(term) {
      if (!term) return;
      $("#results").text("Searching...");
      $("#bookDetails").empty();
      currentSearchTerm = term;

      $.ajax({
        url: `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(term)}&maxResults=50`,
        method: "GET",
        success: function (data) {
          currentResults = data.items || [];
          currentPage = Math.min(currentPage, 5);
          renderPagination(currentResults.length);
          renderResults();
        },
        error: function () {
          $("#results").text("Failed to load search results.");
        }
      });
    }

    $(document).ready(function () {
      $("#searchBtn").on("click", function () {
        const term = $("#searchTerm").val().trim();
        if (term) {
          currentPage = 1;
          performSearch(term);
        }
      });
    });
  </script>
</body>
</html>
